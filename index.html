<script type="module">
	import Module from "./build/php-web.mjs";

	const NUM = "number";
	const STR = "string";
	let body = "";
	const show = () => {
		window.document.body.innerHTML = body;
	};
	let timeout = null;

	Module({
		onAbort(reason) {
			console.error(`WASM aborted: ${reason}`);
		},
		print(data) {
			if (data) {
				body += data;
				clearTimeout(timeout);
				timeout = setTimeout(() => show());
			}
		},
		printErr(data) {
			if (data) {
				console.log("stderr: ", data);
			}
		},
	}).then(({ ccall, FS, IDBFS }) => {
		ccall("pib_init");
		const phpVersion = ccall("pib_exec", STR, [STR], ["phpversion();"]);
		console.log("php version", phpVersion);
		ccall("pib_exec", STR, [STR], ["phpinfo();"]);
	});
</script>
